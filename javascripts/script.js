function init(){$("body").css("background-color",insideBackgroundColor),pageDiagonal=Math.pow($("#inside svg").width(),2)+Math.pow($("#inside svg").height(),2),sceneryOutside=queue.getResult("sceneryOutside"),sloth=document.getElementById(slothString).getBoundingClientRect();for(var e in audioFilenames)void 0===audioFilenames[e].playing&&playSoundObj(audioFilenames[e]);circleRadius=$("#inside svg").height()/magGlassScale,draw(),success===!1&&0==info&&0==title&&($(document).mousemove($.throttle(41,onMouseMove)),$(document).bind("touchmove",$.throttle(41,onMouseMove)),$(document).unbind("click").bind("click",function(e){var i=e.clientX,o=e.clientY;if(void 0===i||void 0===o){e.preventDefault();var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];i=t.pageX,o=t.pageY}_gaq.push(["_trackEvent","game","click","playingField"]),i>sloth.left-circleRadius&&i<sloth.left+sloth.width+(circleRadius-sloth.width)&&o>sloth.top-circleRadius&&o<sloth.top+sloth.height+circleRadius&&(success=!0,turnOffAudio(),$("#success").css("width","100vw").css("height","100vh").css("opacity","1"),audioButton||$("#thememusic").animate({volume:1},500),_gaq.push(["_trackEvent","game","click",slothString]),_gaq.push(["_trackPageview"]))})),$(window).resize(function(){width=window.innerWidth,height=window.innerHeight,foreground.width=width,foreground.height=height,draw(),sloth=document.getElementById(slothString).getBoundingClientRect(),pageDiagonal=Math.pow($("#inside svg").width(),2)+Math.pow($("#inside svg").height(),2);for(var e=0;e<audioFilenames.length;e++)obj=audioFilenames[e],obj.dirAudio&&(obj.audioRect=document.getElementById(obj.elem).getBoundingClientRect(),obj.audioX=obj.audioRect.left+obj.audioRect.width/2,obj.audioY=obj.audioRect.top+obj.audioRect.height/2);circleRadius=$("#inside svg").height()/magGlassScale})}function onMouseMove(e){if(circleX=e.pageX,circleY=e.pageY,void 0===circleX||void 0===circleY){e.preventDefault();var i=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];circleX=i.pageX,circleY=i.pageY-height/15}if(window.requestAnimationFrame(draw),audio&&!audioButton)for(var o in audioFilenames)audioFilenames[o].loaded&&audioFilenames[o].dirAudio&&audioFilenames[o].playing&&directionalAudio(e,audioFilenames[o])}function draw(){ctx.clearRect(prevCircleX-3*circleRadius,prevCircleY-3*circleRadius,6*circleRadius,6*circleRadius),ctx.beginPath(),ctx.arc(circleX,circleY,circleRadius,0,2*Math.PI,!0),ctx.rect(0,0,width,height),ctx.closePath(),clippedImage(sceneryOutside),ctx.beginPath(),ctx.arc(circleX,circleY,circleRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=circleRadius/7,ctx.strokeStyle=magGlassOuterRingColor,ctx.closePath(),prevCircleX=circleX,prevCircleY=circleY}function clippedImage(e){ctx.save(),ctx.clip();var i=width*(e.height/e.width),o=width,t=0;i>height&&(i=height,o=i*(e.width/e.height),t=(width-o)/2),ctx.fillStyle=outsideBackgroundColor,ctx.fill(),ctx.drawImage(e,t,height-i,o,i),animationwrapper.style.width=o,ctx.restore()}function directionalAudio(e,i){var o=e.pageX,t=e.pageY;if(void 0===o||void 0===t){var a=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];o=a.pageX,t=a.pageY}o<i.audioX&&t<i.audioY?vol=(Math.pow(i.audioX-o,2)+Math.pow(i.audioY-t,2))/pageDiagonal:o>i.audioX&&t<i.audioY?vol=(Math.pow(o-i.audioX,2)+Math.pow(i.audioY-t,2))/pageDiagonal:o>i.audioX&&t>i.audioY?vol=(Math.pow(o-i.audioX,2)+Math.pow(t-i.audioY,2))/pageDiagonal:o<i.audioX&&t>i.audioY&&(vol=(Math.pow(i.audioX-o,2)+Math.pow(t-i.audioY,2))/pageDiagonal),1>vol&&vol>0&&i.loaded===!0&&(vol=Math.pow(1-vol,dirAudioScale)*i.vol,i.gainNode.gain.value=vol)}function playSoundObj(e){void 0===e.source&&(e.gainNode=audioContext.createGain(),e.source=audioContext.createBufferSource(),e.source.connect(e.gainNode),e.gainNode.connect(audioContext.destination),e.source.buffer=e.buffer,e.playing=!0,e.source.loop=!0,e.gainNode.gain.value=e.dirAudio||audioButton?0:e.vol,e.dirAudio&&(e.audioRect=document.getElementById(e.elem).getBoundingClientRect(),e.audioX=e.audioRect.left+e.audioRect.width/2,e.audioY=e.audioRect.top+e.audioRect.height/2),e.source.start(0)),void 0!==e.source&&e.playing===!1&&!e.dirAudio&&audioButton&&(e.gainNode.gain.value=e.vol)}function turnOffAudio(){if(!title)for(var e in audioFilenames)audioFilenames[e].loaded&&audioFilenames[e].playing&&(audioFilenames[e].gainNode.gain.value=0,audioFilenames[e].playing=!1);$("#thememusic").animate({volume:0},500),audio=!1}function turnOnAudio(){if(!audioButton){if(!info&&!success&&!title)for(var e in audioFilenames)audioFilenames[e].loaded&&!audioFilenames[e].playing&&(audioFilenames[e].dirAudio||(audioFilenames[e].gainNode.gain.value=audioFilenames[e].vol),audioFilenames[e].playing=!0);audio=!0,(title||success)&&$("#thememusic").animate({volume:1},500)}}function playAgain(){success=!1,$("#success").css("opacity","0"),setTimeout(function(){$("#success").css("width","0").css("height","0"),randomsentence=Math.floor(3*Math.random())+1,successSentenceSrc="scenes/success_screen/sentence"+randomsentence+".svg";var e=(document.getElementById("successwrapper"),new Image);e.onload=function(){$("#successSentence").remove(),$("#successSloth")[0].parentNode.insertBefore(e,$("#successSloth")[0].nextSibling).setAttribute("id","successSentence")},e.src=successSentenceSrc},300),randomnumber=Math.floor(4*Math.random())+1;var e=src+"/animation/sloth"+randomnumber+".gif",i=new Image;i.onload=function(){var i=$("#slothimg");i.attr("src",e),slothString="sloth"+randomnumber,sloth=document.getElementById(slothString).getBoundingClientRect()},i.src=e,init(),audioButton||turnOnAudio(),$("#thememusic").animate({volume:0},500),_gaq.push(["_trackEvent","game","click","playAgain"]),_gaq.push(["_trackPageview"])}console.log("%cInstead of wading through all this minified and obfuscated slush, why not have a look at the full, commented source? You can find it here:","color: #F05050"),console.log("%chttps://github.com/animade/sloth","color: #2C85BD; text-decoration: underline");var magGlassScale=20,dirAudioScale=500,outsideBackgroundColor="#b8fbdd",insideBackgroundColor="#b8fbdd",magGlassOuterRingColor="#86d1bc",src="scenes/"+sceneName,animationSrc=src+"/animation/animation.gif",sceneryOutsideSrc=src+"/sceneries/outside.png",sceneryInsideSrc=src+"/sceneries/inside.svg",audioSrc=src+"/audio/",slothSrc=src+"/animation/sloth"+randomnumber+".gif",width=window.innerWidth,height=window.innerHeight,audioContext,sloth,vol,circleRadius,circleX=width/2,circleY=height/2,prevCircleX,prevCircleY,pageDiagonal,sceneryOutside,animationwrapper=document.getElementById("animationwrapper"),success=!1,audio=!0,audioButton=!1,info=!1;$("#outside").attr("width",width).attr("height",height);var foreground=document.getElementById("outside"),ctx=foreground.getContext("2d"),slothString="sloth"+randomnumber;$("#infobutton").click(function(){if(info)$("#info").css("opacity","0"),$("#i").css("display","block"),$("#e").css("display","none"),setTimeout(function(){$("#info").css("width","0").css("height","0")},250),info=!1,audioButton||success||turnOnAudio(),_gaq.push(["_trackEvent","overlay","click","hideInfo"]);else{if($("#info").css("width","100vw").css("height","100vh").css("opacity","1"),$("#i").css("display","none"),$("#e").css("display","block"),info=!0,!success)for(var e in audioFilenames)audioFilenames[e].loaded&&audioFilenames[e].playing&&audioFilenames[e].dirAudio&&(audioFilenames[e].gainNode.gain.value=0,audioFilenames[e].playing=!1);_gaq.push(["_trackPageview"]),_gaq.push(["_trackEvent","overlay","click","showInfo"])}}),$("#audiobutton").click(function(){audioButton=!audioButton,audioButton?(turnOffAudio(),$("#on").css("display","none"),$("#off").css("display","block"),_gaq.push(["_trackEvent","overlay","click","audioButtonOff"])):(turnOnAudio(),$("#on").css("display","block"),$("#off").css("display","none"),_gaq.push(["_trackEvent","overlay","click","audioButtonOn"]))});
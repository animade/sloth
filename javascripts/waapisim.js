// Copyright (c) 2013 g200kg
if("undefined"==typeof waapisimLogEnable)var waapisimLogEnable=0;if("undefined"==typeof Float32Array&&(Float32Array=function(t){if(t instanceof Array)return t;var i=new Array(t);return i.subarray=function(t,i){return this.slice(t,i)},i.set=function(t,e){for(var a=0;a<t.length;++a)i[e+a]=t[a]},i}),"undefined"==typeof Uint8Array&&(Uint8Array=function(t){if(t instanceof Array)return t;var i=new Array(t);return i.subarray=function(t,i){return this.slice(t,i)},i.set=function(t,e){for(var a=0;a<t.length;++a)i[e+a]=t[a]},i}),waapisimDebug="undefined"!=typeof waapisimLogEnable&&waapisimLogEnable?function(t){console.log(t)}:function(){},"undefined"!=typeof webkitAudioContext&&"undefined"==typeof webkitAudioContext.prototype.createGain&&(webkitAudioContext.prototype.createScriptProcessor=webkitAudioContext.prototype.createJavaScriptNode,webkitAudioContext.prototype.createGain=function(){var t=webkitAudioContext.prototype.createGainNode.call(this);return t._gain=t.gain,t.gain=t._gain,t.gain.setTargetAtTime=t._gain.setTargetValueAtTime,t},webkitAudioContext.prototype.createDelay=function(){var t=webkitAudioContext.prototype.createDelayNode.call(this);return t._delayTime=t.delayTime,t.delayTime=t._delayTime,t.delayTime.setTargetAtTime=t._delayTime.setTargetValueAtTime,t},webkitAudioContext.prototype._createOscillator=webkitAudioContext.prototype.createOscillator,webkitAudioContext.prototype.createOscillator=function(){var t=webkitAudioContext.prototype._createOscillator.call(this);return t._frequency=t.frequency,t.frequency=t._frequency,t.frequency.setTargetAtTime=t._frequency.setTargetValueAtTime,t._detune=t.detune,t.detune=t._detune,t.detune.setTargetAtTime=t._detune.setTargetValueAtTime,t.start=t.noteOn,t.stop=t.noteOff,t},webkitAudioContext.prototype._createBufferSource=webkitAudioContext.prototype.createBufferSource,webkitAudioContext.prototype.createBufferSource=function(){var t=webkitAudioContext.prototype._createBufferSource.call(this);return t._playbackRate=t.playbackRate,t.playbackRate=t._playbackRate,t.playbackRate.setTargetAtTime=t._playbackRate.setTargetValueAtTime,t.start=function(i,e,a){void 0===e?t.noteOn(i):t.noteGrainOn(i,e,a)},t.stop=t.noteOff,t},webkitAudioContext.prototype._createBiquadFilter=webkitAudioContext.prototype.createBiquadFilter,webkitAudioContext.prototype.createBiquadFilter=function(){var t=webkitAudioContext.prototype._createBiquadFilter.call(this);return t._frequency=t.frequency,t.frequency=t._frequency,t.frequency.setTargetAtTime=t._frequency.setTargetValueAtTime,t._Q=t.Q,t.Q=t._Q,t.Q.setTargetAtTime=t._Q.setTargetValueAtTime,t._gain=t.gain,t.gain=t._gain,t.gain.setTargetAtTime=t._gain.setTargetValueAtTime,t},webkitAudioContext.prototype._createDynamicsCompressor=webkitAudioContext.prototype.createDynamicsCompressor,webkitAudioContext.prototype.createDynamicsCompressor=function(){var t=webkitAudioContext.prototype._createDynamicsCompressor.call(this);return t._threshold=t.threshold,t.threshold=t._threshold,t.threshold.setTargetAtTime=t._threshold.setTargetValueAtTime,t._knee=t.knee,t.knee=t._knee,t.knee.setTargetAtTime=t._knee.setTargetValueAtTime,t._ratio=t.ratio,t.ratio=t._ratio,t.ratio.setTargetAtTime=t._ratio.setTargetValueAtTime,t._attack=t.attack,t.attack=t._attack,t.attack.setTargetAtTime=t._attack.setTargetValueAtTime,t}),"undefined"!=typeof waapisimForceSim&&waapisimForceSim||"undefined"!=typeof AudioContext&&"undefined"==typeof AudioContext.prototype.createOscillator&&("undefined"==typeof waapisimForceSimWhenLackOsc||"undefined"!=typeof waapisimForceSimWhenLackOsc&&waapisimForceSimWhenLackOsc)||"undefined"==typeof webkitAudioContext&&"undefined"!=typeof waapisimForceSimWhenNotWebkit&&waapisimForceSimWhenNotWebkit||"undefined"==typeof webkitAudioContext&&"undefined"==typeof AudioContext){waapisimSampleRate=44100,waapisimAudioIf=0,waapisimBufSize=1024,waapisimFlashBufSize=3072,"undefined"!=typeof Audio&&(waapisimAudio=new Audio,"undefined"!=typeof waapisimAudio.mozSetup&&(waapisimAudioIf=1)),0===waapisimAudioIf?(waapisimOutBufSize=waapisimFlashBufSize,waapisimOutBuf=new Array(2*waapisimOutBufSize)):(waapisimOutBufSize=waapisimBufSize,waapisimOutBuf=new Float32Array(2*waapisimOutBufSize),waapisimAudio.mozSetup(2,waapisimSampleRate));for(var l=waapisimOutBuf.length,i=0;l>i;++i)waapisimOutBuf[i]=0;switch(waapisimWrittenpos=0,waapisimNodeId=0,waapisimContexts=[],waapisimAudioBuffer=function(t,i,e){var a,s;if("number"==typeof t)for(i|=0,this.sampleRate=e,this.length=i,this.duration=i/this.sampleRate,this.numberOfChannels=t,this.buf=[],a=0;2>a;++a)for(this.buf[a]=new Float32Array(i),s=0;i>s;++s)this.buf[a][s]=0;else{var n;this.sampleRate=44100,this.buf=[],this.buf[0]=new Float32Array(0),this.buf[1]=new Float32Array(0),this.Get4BStr=function(t,i){return String.fromCharCode(t[i],t[i+1],t[i+2],t[i+3])},this.GetDw=function(t,i){return t[i]+(t[i+1]<<8)+(t[i+2]<<16)+(t[i+3]<<24)},this.GetWd=function(t,i){return t[i]+(t[i+1]<<8)},n=new Uint8Array(t);var o=i,h=this.Get4BStr(n,0);if(this.length=0,"RIFF"==h){var r=this.GetDw(n,4)+8,u=this.Get4BStr(n,8),f=0,p=1,d=16;if("WAVE"==u)for(var c=12;r>c;){var l=this.Get4BStr(n,c),m=this.GetDw(n,c+4);if("fmt "==l&&(f=this.GetWd(n,c+8),p=this.GetWd(n,c+10),this.sampleRate=this.GetDw(n,c+12),d=this.GetWd(n,c+22)),"data"==l){this.length=m/p/(d/8)|0,this.buf[0]=new Float32Array(this.length),this.buf[1]=new Float32Array(this.length),this.numberOfChannels=p,this.duration=this.length/this.sampleRate;var _,w;for(a=0,s=0;a<this.length;++a)24==d?2==p?(_=n[c+s+9]+(n[c+s+10]<<8),w=n[c+s+12]+(n[c+s+13]<<8),_>=32768&&(_-=65536),w>=32768&&(w-=65536),o===!0&&(_=w=.5*(_+w)),this.buf[0][a]=_/32768,this.buf[1][a]=w/32768,s+=6):(v=n[c+s+9]+(n[c+s+10]<<8),v>=32768&&(v-=65536),this.buf[0][a]=this.buf[1][a]=v/32768,s+=3):16==d?2==p?(_=n[c+s+8]+(n[c+s+9]<<8),w=n[c+s+10]+(n[c+s+11]<<8),_>=32768&&(_-=65536),w>=32768&&(w-=65536),o===!0&&(_=w=.5*(_+w)),this.buf[0][a]=_/32768,this.buf[1][a]=w/32768,s+=4):(v=n[c+s+8]+(n[c+s+9]<<8),v>=32768&&(v-=65536),this.buf[0][a]=this.buf[1][a]=v/32768,s+=2):2==p?(_=n[c+s+8]/128-1,w=n[c+s+9]/128-1,o===!0&&(_=w=.5*(_+w)),this.buf[0][a]=_,this.buf[1][a]=w,s+=2):(this.buf[0][a]=this.buf[1][a]=n[c+s+8]/128-1,s++)}c+=m+8}}}this.getChannelData=function(t){return this.buf[t]}},waapisimDummybuf=new waapisimAudioBuffer(2,waapisimBufSize,waapisimSampleRate),waapisimSetupOutBuf=function(t){var i,e,a,s,n=waapisimContexts.length;for(i=2*(t+waapisimBufSize),e=2*t;i>e;e+=2)waapisimOutBuf[e]=waapisimOutBuf[e+1]=0;for(a=0;n>a;++a){for(var o=waapisimContexts[a];;){for(i=o._Nodes.length,e=0;i>e;++e)if(s=o._Nodes[e],3==s.playbackState){s.disconnect(),o._UnregisterNode(s);break}if(e==i)break}for(i=o._Nodes.length,e=0;i>e;++e)o._Nodes[e]._Process();if(s=o.destination,s._nodein[0].from.length>0){var h=s._nodein[0].inbuf.buf;for(e=0;waapisimBufSize>e;++e)waapisimOutBuf[2*(e+t)]+=h[0][e],waapisimOutBuf[2*(e+t)+1]+=h[1][e]}s._nodein[0].NodeClear()}},waapisimUpdateCurrentTime=function(t){for(var i=waapisimContexts.length;i--;)waapisimContexts[i].currentTime=t},waapisimInterval=function(){var t=waapisimAudio.mozCurrentSampleOffset(),i=waapisimWrittenpos-t;waapisimUpdateCurrentTime(t/(2*waapisimSampleRate)),16384>i&&(waapisimSetupOutBuf(0),waapisimWrittenpos+=waapisimAudio.mozWriteAudio(waapisimOutBuf))},waapisimGetSwfPath=function(){var t=document.getElementsByTagName("SCRIPT");if(t&&t.length>0)for(var i in t)if(t[i].src&&t[i].src.match(/waapisim\.js$/)){var e=t[i].src;return e.substring(0,e.length-2)+"swf"}return""},waapisimAddFlashObj=function(){var t=document.createElement("DIV");t.setAttribute("id","WAAPISIMFLASHOBJ"),t.setAttribute("style","background:#ff00ff;position:static;");var i=document.getElementsByTagName("BODY");i[0].appendChild(t),document.getElementById("WAAPISIMFLASHOBJ").innerHTML="<div style='position:fixed;right:0px;bottom:0px'> <object id='waapisim_swf' CLASSID='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000' CODEBASE='http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=4,0,0,0' width=150 height=20><param name=movie value='"+waapisimSwfPath+"'><PARAM NAME=bgcolor VALUE=#FFFFFF><PARAM NAME=LOOP VALUE=false><PARAM NAME=quality VALUE=high><param name='allowScriptAccess' value='always'><embed src='"+waapisimSwfPath+"' width=150 height=20 bgcolor=#FFFFFF loop=false quality=high pluginspage='http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash' type='application/x-shockwave-flash' allowScriptAccess='always'></embed></object></div>","undefined"==typeof document.getElementById("waapisim_swf").SetReturnValue&&(document.getElementById("waapisim_swf").SetReturnValue=function(t){document.getElementById("waapisim_swf").impl.SetReturnValue(t)})},waapisimFlashOffset=function(t){waapisimUpdateCurrentTime(t/1e3)},waapisimFlashGetData=function(){var t,e="";for(t=waapisimOutBufSize/waapisimBufSize,i=0;t>i;++i)waapisimSetupOutBuf(waapisimBufSize*i);for(waapisimWrittenpos+=2*waapisimOutBufSize,t=2*waapisimOutBufSize,i=0;t>i;++i){var a=16384*waapisimOutBuf[i]+32768|0;isNaN(a)&&(a=32768),a=Math.min(49152,Math.max(16384,a)),e+=String.fromCharCode(a)}return e},waapisimAudioIf){case 0:waapisimSwfPath=waapisimGetSwfPath(),window.addEventListener("load",waapisimAddFlashObj,!1);break;case 1:setInterval(waapisimInterval,10)}AudioContext=webkitAudioContext=function(){waapisimContexts.push(this),this._Nodes=[],this.destination=new waapisimAudioDestinationNode(this),this.sampleRate=44100,this.currentTime=0,this.activeSourceCount=0,this.listener=new waapisimAudioListener,this.createBuffer=function(t,i,e){return new waapisimAudioBuffer(t,i,e)},this.createBufferSource=function(){return new waapisimAudioBufferSource(this)},this.createScriptProcessor=this.createJavaScriptNode=function(t,i,e){return new waapisimScriptProcessor(this,t,i,e)},this.createBiquadFilter=function(){return new waapisimBiquadFilter(this)},this.createGain=this.createGainNode=function(){return new waapisimGain(this)},this.createDelay=this.createDelayNode=function(){return new waapisimDelay(this)},this.createOscillator=function(){return new waapisimOscillator(this)},this.createAnalyser=function(){return new waapisimAnalyser(this)},this.createConvolver=function(){return new waapisimConvolver(this)},this.createDynamicsCompressor=function(){return new waapisimDynamicsCompressor(this)},this.createPanner=function(){return new waapisimPanner(this)},this.createChannelSplitter=function(t){return new waapisimChannelSplitter(this,t)},this.createChannelMerger=function(t){return new waapisimChannelMerger(this,t)},this.createWaveShaper=function(){return new waapisimWaveShaper(this)},this.decodeAudioData=function(t,i,e){var a=new waapisimAudioBuffer(t,!1);a.length>0?i(a):e()},this.createPeriodicWave=this.createWaveTable=function(t,i){return new waapisimPeriodicWave(t,i)},this._SortNode=function(){var t,i,e,a;for(t=0;t<this._Nodes.length;++t)if(a=this._Nodes[t],a._order>0)for(i=0;i<a._nodein.length;++i)for(e=0;e<a._nodein[i].from.length;++e){var s=a._nodein[i].from[e].node._order;a._order<s+1&&(a._order=s+1)}this._Nodes.sort(function(t,i){return i._order-t._order})},this._RegisterNode=function(t){for(var i=this._Nodes.length;i--;)if(this._Nodes[i]===t)return!1;return this._Nodes.push(t),this._SortNode(),!0},this._UnregisterNode=function(t){for(var i=this._Nodes.length;i--;)this._Nodes[i]==t&&this._Nodes.splice(i,1)}},waapisimAudioListener=function(){this.px=0,this.py=0,this.pz=0,this.ox=0,this.oy=0,this.oz=-1,this.ux=0,this.uy=1,this.uz=0,this.dopplerFactor=1,this.speedOfSound=343.3,this.setPosition=function(t,i,e){this.px=t,this.py=i,this.pz=e},this.setOrientation=function(t,i,e,a,s,n){this.ox=t,this.oy=i,this.oz=e,this.ux=a,this.uy=s,this.uz=n},this.setVelocity=function(){}},waapisimPeriodicWave=function(t,i){var e=4096,a=new Array(e),s=new Array(e);this.buf=new Float32Array(e);var n,o,h,r,u,f,p,d,c;for(h=0;e>h;++h)a[h]=s[h]=0;h=r=0;do{a[h]=t[r],s[h]=-i[r];for(var u=e>>1;u>(h^=u);u>>=1);}while(++r<t.length);var l=2*Math.PI;for(o=1;(n=o<<1)<=e;o=n)for(l*=.5,h=0;o>h;h++)for(f=Math.cos(l*h),p=Math.sin(l*h),r=h;e>r;r+=n)u=r+o,d=f*a[u]-p*s[u],c=f*s[u]+p*a[u],a[u]=a[r]-d,s[u]=s[r]-c,a[r]+=d,s[r]+=c;var m=0;for(h=0;e>h;++h){var _=Math.abs(a[h]);_>m&&(m=_)}if(0==m)for(h=0;e>h;++h)this.buf[h]=0;else for(h=0;e>h;++h)this.buf[h]=a[h]/m},waapisimAudioNode=function(t,i,e){this.numberOfInputs=i,this.numberOfOutputs=e,this._nodeId=waapisimNodeId,this._order=1,++waapisimNodeId,this._targettype=1,this.context=null,this._nodein=[],this._nodeout=[];var a;for(a=0;i>a;++a)this._nodein[a]=new waapisimAudioNodeIn(this,t);for(a=0;e>a;++a)this._nodeout[a]=new waapisimAudioNodeOut(this,t);this.connect=function(t,i,e){"undefined"==typeof i&&(i=0),"undefined"==typeof e&&(e=0),this._nodeout[i]&&this._nodeout[i].connect(0!==t._targettype?t._nodein[e]:t)},this.disconnect=function(t){"undefined"==typeof this._nodeout[t]&&(t=0),this._nodeout[t].disconnect()}},waapisimAudioNodeIn=function(t,i){this.node=t,this.from=[],this.inbuf=new waapisimAudioBuffer(2,i,waapisimSampleRate),this.NodeClear=function(){for(var t=0;waapisimBufSize>t;++t)this.inbuf.buf[0][t]=this.inbuf.buf[1][t]=0}},waapisimAudioNodeOut=function(t,i){this.node=t,this.to=[],this.connect=function(t){if(waapisimDebug("connect "+this.node._nodetype+this.node._nodeId+"=>"+t.node._nodetype+t.node._nodeId),void 0!==t&&-1==t.from.indexOf(this)&&(t.from.push(this),-1==this.to.indexOf(t)&&this.to.push(t),0!==t.node._targettype&&this.node.context._RegisterNode(t.node)))for(var i=0;i<t.node._nodeout.length;++i)for(var e=0;e<t.node._nodeout[i].to.length;++e)t.node._nodeout[i].connect(t.node._nodeout[i].to[e])},this.disconnectTemp=function(){var t,i,e,a,s,n,o;waapisimDebug("disconnect "+this.node._nodetype+this.node._nodeId);var h=this.node.context._Nodes;for(e=h.length,t=0;e>t;++t)for(n=h[t]._nodein.length,s=0;n>s;++s)i=h[t]._nodein[s].from.indexOf(this),i>=0&&(waapisimDebug("  :"+this.node._nodeId+"=>"+h[t]._nodeId),h[t]._nodein[s].from.splice(i,1));for(t=0;t<h.length;++t)if(o=h[t],1==o._targettype){for(a=0,s=0;s<o._nodein.length;++s)a+=o._nodein[s].from.length;if(0===a){for(this.node.context._UnregisterNode(o),s=0;s<o._nodeout.length;++s)o._nodeout[s].disconnectTemp();break}}},this.disconnect=function(){this.disconnectTemp(),this.to.length=0},this.NodeEmit=function(t,i,e){for(var a=this.to.length,s=0;a>s;++s){var n=this.to[s].inbuf.buf;n[0][t]+=i,n[1][t]+=e}},this.NodeEmitBuf=function(){for(var t=this.to.length,i=0;t>i;++i)for(var e=this.to[i].inbuf.buf[0],a=this.to[i].inbuf.buf[1],s=0;waapisimBufSize>s;++s)e[s]+=this.outbuf.buf[0][s],a[s]+=this.outbuf.buf[1][s]},this.outbuf=new waapisimAudioBuffer(2,i,waapisimSampleRate)},waapisimAudioProcessingEvent=function(){},waapisimAudioDestinationNode=function(t){waapisimAudioNode.call(this,waapisimBufSize,1,0),this._nodetype="Destination",waapisimDebug("create "+this._nodetype+this._nodeId),this._targettype=2,this.context=t,this.playbackState=0,this.maxNumberOfChannels=2,this.numberOfChannels=2,this._Process=function(){},t._Nodes.push(this)},waapisimAudioBufferSource=webkitAudioBufferSourceNode=AudioBufferSourceNode=function(t){waapisimAudioNode.call(this,waapisimBufSize,0,1),this._nodetype="BufSrc",waapisimDebug("create "+this._nodetype+this._nodeId),this._targettype=3,this._order=0,this.context=t,this.playbackState=0,this.buffer=null,this.playbackRate=new waapisimAudioParam(t,this,0,10,1),this.gain=new waapisimAudioParam(t,this,0,1,1),this.loop=!1,this.loopStart=0,this.loopEnd=0,this._bufferindex=0,this._whenstart=0,this._whenstop=Number.MAX_VALUE,this._endindex=0,this._actualLoopStart=0,this._actualLoopEnd=0,this.start=this.noteOn=this.noteGrainOn=function(t,i,e){null!==this.buffer&&(this.playbackState=1,this._whenstart=t,i>0&&(this._bufferindex=i*waapisimSampleRate),this._endindex=this.buffer.length,e>0&&(this._endindex=Math.min(this.buffer.length,(e+i)*waapisimSampleRate)),this.loop&&((this.loopStart||this.loopEnd)&&this.loopStart>=0&&this.loopEnd>0&&this.loopStart<this.loopEnd?(this._actualLoopStart=this.loopStart,this._actualLoopEnd=Math.min(this.loopEnd,this.buffer.length)):(this._actualLoopStart=0,this._actualLoopEnd=this.buffer.length)),this.context._RegisterNode(this))},this.stop=this.noteOff=function(t){this._whenstop=t},this._Process=function(){if(this.playbackRate._Process(),null!==this.buffer&&this._bufferindex>=this._endindex&&(2==this.playbackState&&--this.context.activeSourceCount,this.playbackState=3),1==this.playbackState&&this.context.currentTime>=this._whenstart&&(this.playbackState=2,++this.context.activeSourceCount),2==this.playbackState&&this.context.currentTime>=this._whenstop&&(this.playbackState=3,--this.context.activeSourceCount),2==this.playbackState){var t=this.buffer.getChannelData(0),i=this.buffer.getChannelData(1),e=this.buffer.sampleRate/44100;if(this._nodeout[0].to.length>0){for(var a=0;waapisimBufSize>a;++a){if(this._bufferindex<this._endindex){var s=this.gain.Get(a),n=0|this._bufferindex;this._nodeout[0].outbuf.buf[0][a]=t[n]*s,this._nodeout[0].outbuf.buf[1][a]=i[n]*s}this._bufferindex+=e*this.playbackRate.Get(a),this.loop&&this._bufferindex>=this._actualLoopEnd&&(this._bufferindex=this._actualLoopStart)}this._nodeout[0].NodeEmitBuf(),this.playbackRate.Clear(!0)}}}},waapisimAudioBufferSource.UNSCHEDULED_STATE=waapisimAudioBufferSource.prototype.UNSCHEDULED_STATE=0,waapisimAudioBufferSource.SCHEDULED_STATE=waapisimAudioBufferSource.prototype.SCHEDULED_STATE=1,waapisimAudioBufferSource.PLAYING_STATE=waapisimAudioBufferSource.prototype.PLAYING_STATE=2,waapisimAudioBufferSource.FINISHED_STATE=waapisimAudioBufferSource.prototype.FINISHED_STATE=3,waapisimScriptProcessor=function(t,i,e,a){if(waapisimAudioNode.call(this,waapisimBufSize,1,1),this._nodetype="ScrProc",waapisimDebug("create "+this._nodetype+this._nodeId),this._targettype=2,this.context=t,this.playbackState=0,"number"!=typeof i)throw new TypeError("ScriptProcessor:bufferSize");"undefined"==typeof e&&(e=2),"undefined"==typeof a&&(a=2),this.bufferSize=i,this._scrinbuf=new waapisimAudioBuffer(e,i,waapisimSampleRate),this._scroutbuf=new waapisimAudioBuffer(a,i,waapisimSampleRate),this._index=i,this.onaudioprocess=null,this._Process=function(){var t=this._nodein[0].inbuf;null===t&&(t=waapisimDummybuf);for(var i=0;waapisimBufSize>i;++i){if(this._index>=this.bufferSize){if(this.onaudioprocess){var e=new waapisimAudioProcessingEvent;e.node=this,e.inputBuffer=this._scrinbuf,e.outputBuffer=this._scroutbuf,this.onaudioprocess(e)}this._index=0}this._scrinbuf.buf[0][this._index]=t.buf[0][i],this._scrinbuf.numberOfChannels>=2&&(this._scrinbuf.buf[1][this._index]=t.buf[1][i]),this._scroutbuf.numberOfChannels>=2?this._nodeout[0].NodeEmit(i,this._scroutbuf.buf[0][this._index],this._scroutbuf.buf[1][this._index]):this._nodeout[0].NodeEmit(i,this._scroutbuf.buf[0][this._index],this._scroutbuf.buf[0][this._index]),this._index++}this._nodein[0].NodeClear()},t._RegisterNode(this)},waapisimBiquadFilter=webkitBiquadFilterNode=BiquadFilterNode=function(t){waapisimAudioNode.call(this,waapisimBufSize,1,1),this._nodetype="Filter",waapisimDebug("create "+this._nodetype+this._nodeId),this.context=t,this.playbackState=0,this.type=0,this.frequency=new waapisimAudioParam(t,this,10,24e3,350,.5),this.detune=new waapisimAudioParam(t,this,-4800,4800,0,.5),this.Q=new waapisimAudioParam(t,this,1e-4,1e3,1,.5),this.gain=new waapisimAudioParam(t,this,-40,40,0,.5),this._a1=this._a2=0,this._b0=this._b1=this._b2=0,this._x1l=this._x1r=this._x2l=this._x2r=0,this._y1l=this._y1r=this._y2l=this._y2r=0,this._nodein[0].NodeClear(),this._Setup=function(t){var i,e,a,s=t.frequency.Get(0)*Math.pow(2,t.detune.Get(0)/1200),n=Math.max(.001,t.Q.Get(0)),o=2*Math.PI*s/t.context.sampleRate,h=Math.cos(o);switch(t.type){case"lowpass":case 0:n=Math.pow(10,n/20),i=Math.sin(o)/(2*n),e=1/(1+i),t._a1=-2*h*e,t._a2=(1-i)*e,t._b0=t._b2=(1-h)/2*e,t._b1=(1-h)*e;break;case"highpass":case 1:n=Math.pow(10,n/20),i=Math.sin(o)/(2*n),e=1/(1+i),t._a1=-2*h*e,t._a2=(1-i)*e,t._b0=t._b2=(1+h)/2*e,t._b1=-(1+h)*e;break;case"bandpass":case 2:i=Math.sin(o)/(2*n),e=1/(1+i),t._a1=-2*h*e,t._a2=(1-i)*e,t._b0=i,t._b1=0,t._b2=-i;break;case"lowshelf":case 3:i=Math.sin(o)/2*Math.sqrt(2),a=Math.pow(10,t.gain.Get(0)/40),e=1/(a+1+(a-1)*h+2*Math.sqrt(a)*i),t._a1=-2*(a-1+(a+1)*h)*e,t._a2=(a+1+(a-1)*h-2*Math.sqrt(a)*i)*e,t._b0=a*(a+1-(a-1)*h+2*Math.sqrt(a)*i)*e,t._b1=2*a*(a-1-(a+1)*h)*e,t._b2=a*(a+1-(a-1)*h-2*Math.sqrt(a)*i)*e;break;case"highshelf":case 4:i=Math.sin(o)/2*Math.sqrt(2),a=Math.pow(10,t.gain.Get(0)/40),e=1/(a+1-(a-1)*h+2*Math.sqrt(a)*i),t._a1=2*(a-1-(a+1)*h)*e,t._a2=(a+1-(a-1)*h-2*Math.sqrt(a)*i)*e,t._b0=a*(a+1+(a-1)*h+2*Math.sqrt(a)*i)*e,t._b1=-2*a*(a-1+(a+1)*h)*e,t._b2=a*(a+1+(a-1)*h-2*Math.sqrt(a)*i)*e;break;case"peaking":case 5:i=Math.sin(o)/(2*n),a=Math.pow(10,t.gain.Get(0)/40),e=1/(1+i/a),t._a1=-2*h*e,t._a2=(1-i/a)*e,t._b0=(1+i*a)*e,t._b1=-2*h*e,t._b2=(1-i*a)*e;break;case"notch":case 6:i=Math.sin(o)/(2*n),e=1/(1+i),t._a1=-2*h*e,t._a2=(1-i)*e,t._b0=t._b2=e,t._b1=-2*h*e;break;case"allpass":case 7:i=Math.sin(o)/(2*n),e=1/(1+i),t._a1=-2*h*e,t._a2=(1-i)*e,t._b0=(1-i)*e,t._b1=-2*h*e,t._b2=(1+i)*e}},this._Process=function(){var t,i,e,a;this.frequency._Process(),this.detune._Process(),this.Q._Process(),this.gain._Process(),this._Setup(this);for(var s=this._nodein[0].inbuf.buf,n=this._nodeout[0].outbuf.buf,o=0;waapisimBufSize>o;++o)t=s[0][o],i=s[1][o],e=this._b0*t+this._b1*this._x1l+this._b2*this._x2l-this._a1*this._y1l-this._a2*this._y2l,a=this._b0*i+this._b1*this._x1r+this._b2*this._x2r-this._a1*this._y1r-this._a2*this._y2r,this._x2l=this._x1l,this._x2r=this._x1r,this._x1l=t,this._x1r=i,this._y2l=this._y1l,this._y2r=this._y1r,this._y1l=e,this._y1r=a,n[0][o]=e,n[1][o]=a;this._nodeout[0].NodeEmitBuf(),this._nodein[0].NodeClear(),this.frequency.Clear(!1),this.detune.Clear(!1),this.Q.Clear(!1),this.gain.Clear(!1)},this.getFrequencyResponse=function(t,i,e){for(var a=t.length,s=0;a>s;++s){var n=2*Math.PI*t[s]/this.context.sampleRate,o=Math.cos(n),h=Math.cos(2*n),r=Math.sin(n),u=Math.sin(2*n),f=1+this._a1*o+this._a2*h,p=this._a1*r+this._a2*u,d=this._b0+this._b1*o+this._b2*h,c=this._b1*r+this._b2*u;i[s]=Math.sqrt((d*d+c*c)/(f*f+p*p)),e[s]=Math.atan2(p,f)-Math.atan2(c,d)}}},waapisimBiquadFilter.LOWPASS=waapisimBiquadFilter.prototype.LOWPASS=0,waapisimBiquadFilter.HIGHPASS=waapisimBiquadFilter.prototype.HIGHPASS=1,waapisimBiquadFilter.BANDPASS=waapisimBiquadFilter.prototype.BANDPASS=2,waapisimBiquadFilter.LOWSHELF=waapisimBiquadFilter.prototype.LOWSHELF=3,waapisimBiquadFilter.HIGHSHELF=waapisimBiquadFilter.prototype.HIGHSHELF=4,waapisimBiquadFilter.PEAKING=waapisimBiquadFilter.prototype.PEAKING=5,waapisimBiquadFilter.NOTCH=waapisimBiquadFilter.prototype.NOTCH=6,waapisimBiquadFilter.ALLPASS=waapisimBiquadFilter.prototype.ALLPASS=7,waapisimGain=function(t){waapisimAudioNode.call(this,waapisimBufSize,1,1),this._nodetype="Gain",waapisimDebug("create "+this._nodetype+this._nodeId),this.context=t,this.playbackState=0,this.gain=new waapisimAudioParam(t,this,0,1,1),this._nodein[0].NodeClear(),this._curgain=1,this._Process=function(){var t;this.gain._Process();var i=this._nodein[0].inbuf.buf;switch(this._nodeout[0].to.length){case 0:this._curgain=this.gain.Get(0);break;case 1:var e=this._nodeout[0].to[0].inbuf.buf;for(t=0;waapisimBufSize>t;++t){var a=this.gain.Get(t);this._curgain+=.01*(a-this._curgain),e[0][t]+=i[0][t]*this._curgain,e[1][t]+=i[1][t]*this._curgain}break;default:for(t=0;waapisimBufSize>t;++t){var a=this.gain.Get(t);this._curgain+=.01*(a-this._curgain),this._nodeout[0].NodeEmit(t,i[0][t]*this._curgain,i[1][t]*this._curgain)}}this._nodein[0].NodeClear(),this.gain.Clear(!0)}},waapisimDelay=function(t){waapisimAudioNode.call(this,waapisimBufSize,1,1),this._nodetype="Delay",waapisimDebug("create "+this._nodetype+this._nodeId),this.context=t,this.playbackState=0,this.delayTime=new waapisimAudioParam(t,this,0,1,0),this._bufl=new Float32Array(waapisimSampleRate),this._bufr=new Float32Array(waapisimSampleRate);for(var i=0;waapisimSampleRate>i;++i)this._bufl[i]=this._bufr[i]=0;this._index=0,this._offscur=0,this._Process=function(){this.delayTime._Process();var t=this._nodein[0].inbuf.buf,i=this._nodeout[0].outbuf.buf,e=Math.floor(this.delayTime.Get(0)*this.context.sampleRate);0>e&&(e=0),e>=this.context.sampleRate&&(e=this.context.sampleRate-1);for(var a=(e-this._offscur)/waapisimBufSize,s=0;waapisimBufSize>s;++s){var n=this._index-(0|this._offscur);0>n&&(n+=waapisimSampleRate),this._bufl[this._index]=t[0][s],this._bufr[this._index]=t[1][s],i[0][s]=this._bufl[n],i[1][s]=this._bufr[n],++this._index>=waapisimSampleRate&&(this._index=0),this._offscur+=a}this._nodeout[0].NodeEmitBuf(),this._nodein[0].NodeClear(),this.delayTime.Clear(!1)}},waapisimOscillator=webkitOscillatorNode=OscillatorNode=function(t){waapisimAudioNode.call(this,waapisimBufSize,0,1),this._nodetype="Osc",waapisimDebug("create "+this._nodetype+this._nodeId),this._targettype=3,this._order=0,this.context=t,this.type=0,this._wavtable=null,this.frequency=new waapisimAudioParam(t,this,1,2e4,440,.9995),this.detune=new waapisimAudioParam(t,this,-4800,4800,0,.9995),this.playbackState=0,this._phase=.5,this._whenstart=0,this._whenstop=Number.MAX_VALUE,this._init=0,this.start=this.noteOn=function(t){this._whenstart=t,this.playbackState=1,this.context._RegisterNode(this)},this.stop=this.noteOff=function(t){this._whenstop=t},this.setPeriodicWave=this.setWaveTable=function(t){this.type=4,this._wavtable=t},this._Process=function(){var t;if(0==this._init&&(this.frequency.Init(),this.detune.Init(),this._init=1),this.frequency._Process(),this.detune._Process(),1==this.playbackState&&this.context.currentTime>=this._whenstart&&(this.playbackState=2),2==this.playbackState&&this.context.currentTime>=this._whenstop&&(this.playbackState=3),2==this.playbackState){var i,e,a,s,n,o=this._nodeout[0].outbuf.buf,h=this._phase,r=1/this.context.sampleRate,u=this.frequency,f=this.detune;switch(this.type){case"sine":case 0:e=.5,a=1.5,s=2*Math.PI,n=1/6.78;break;case"square":case 1:e=.5,a=1.5,s=1e5,n=0;break;case"sawtooth":case 2:e=0,a=2,s=2,n=0;break;case"triangle":case 3:e=.5,a=1.5,s=4,n=0;break;case"custom":case 4:for(t=0;waapisimBufSize>t;++t){var p=u.Get(t)*Math.pow(2,f.Get(t)/1200);h+=p*r,h-=Math.floor(h);var d=0;this._wavtable&&(d=this._wavtable.buf[4096*h|0]),o[0][t]=o[1][t]=d}return this._phase=h,this._nodeout[0].NodeEmitBuf(),this.frequency.Clear(!0),void this.detune.Clear(!0)}for(t=0;waapisimBufSize>t;++t){var p=u.Get(t)*Math.pow(2,f.Get(t)/1200);h+=p*r,h-=Math.floor(h),i=(Math.min(Math.max(h,e-h),a-h)-.5)*s;var d=i-i*i*i*n;d>1&&(d=1),-1>d&&(d=-1),o[0][t]=o[1][t]=d}this._phase=h,this._nodeout[0].NodeEmitBuf(),this.frequency.Clear(!0),this.detune.Clear(!0)}else for(t=0;waapisimBufSize>t;++t)this._nodeout[0].outbuf.buf[0][t]=this._nodeout[0].outbuf.buf[1][t]=0}},waapisimOscillator.SINE=waapisimOscillator.prototype.SINE=0,waapisimOscillator.SQUARE=waapisimOscillator.prototype.SQUARE=1,waapisimOscillator.SAWTOOTH=waapisimOscillator.prototype.SAWTOOTH=2,waapisimOscillator.TRIANGLE=waapisimOscillator.prototype.TRIANGLE=3,waapisimOscillator.CUSTOM=waapisimOscillator.prototype.CUSTOM=4,waapisimOscillator.UNSCHEDULED_STATE=waapisimOscillator.prototype.UNSCHEDULED_STATE=0,waapisimOscillator.SCHEDULED_STATE=waapisimOscillator.prototype.SCHEDULED_STATE=1,waapisimOscillator.PLAYING_STATE=waapisimOscillator.prototype.PLAYING_STATE=2,waapisimOscillator.FINISHED_STATE=waapisimOscillator.prototype.FINISHED_STATE=3,waapisimAnalyser=function(t){waapisimAudioNode.call(this,waapisimBufSize,1,1),this._nodetype="Analyser",waapisimDebug("create "+this._nodetype+this._nodeId),this.context=t,this.playbackState=0,this.fftSize=2048,this.frequencyBinCount=1024,this.minDecibels=-100,this.maxDecibels=-30,this.smoothingTimeConstant=0,this._fftInData=new Array(2048),this._fftOutData=new Array(2048),this._timeData=new Array(2048),this._fftIndex=0,this._fftCurrentSize=0,this._fftrev=new Array(256),this._fft=function(t,i,e){var a,s,n,o,h,r,u,f,p,d,c,l=t>>1,m=-2*Math.PI;for(s=1;(a=s<<1)<=t;s=a){for(n=s>>1,m*=.5,r=0;t>r;r+=a)f=r+s,d=i[f],i[f]=i[r]-d,i[r]+=d;for(o=1;n>o;++o){var _=Math.cos(m*o),w=Math.sin(m*o);for(h=0;t>h;h+=a)r=h+o,u=h+s-o,f=h+s+o,p=h+a-o,d=_*i[f]+w*i[p],c=_*i[p]-w*i[f],i[f]=-i[u]+c,i[p]=i[u]+c,i[u]=i[r]-d,i[r]=i[r]+d}}i[0]=Math.min(1e-100,Math.abs(i[0]/t));var b=Math.min(1,Math.max(0,this.smoothingTimeConstant));for(e[0]=e[0]*b+(1-b)*i[0],o=0;l>o;++o){var y=Math.sqrt(i[o]*i[o]+i[t-o]*i[t-o])/t;1e-100>y&&(y=1e-100),e[o]=e[o]*b+(1-b)*y}},this.getByteFrequencyData=function(t){for(var i=this.maxDecibels-this.minDecibels,e=Math.min(t.length,this.frequencyBinCount),a=0;e>a;++a){var s=20*Math.LOG10E*Math.log(this._fftOutData[a]);t[a]=255*(Math.min(this.maxDecibels,Math.max(this.minDecibels,s))-this.minDecibels)/i|0}},this.getFloatFrequencyData=function(t){for(var i=Math.min(t.length,this.frequencyBinCount),e=0;i>e;++e)t[e]=20*Math.LOG10E*Math.log(this._fftOutData[e])},this.getByteTimeDomainData=function(t){for(var i=Math.min(this.frequencyBinCount,t.length),e=0;i>e;++e){var a=Math.min(1,Math.max(-1,this._timeData[e]));t[e]=127*a+128}},this._Process=function(){var t,i,e,a=this._nodein[0].inbuf.buf;if(this.fftSize!=this._fftCurrentSize){var s=this.fftSize;for(t=0;s>t;++t)this._fftInData[t]=this._fftOutData[t]=0;for(this._fftCurrentSize=s,this.frequencyBinCount=.5*s,this._fftIndex=0,this._fftrev[0]=0,this._fftrev[s-1]=s-1,t=0,i=1;s-1>i;++i){for(e=s>>1;e>(t^=e);e>>=1);this._fftrev[i]=t}}for(t=0;waapisimBufSize>t;++t){var n=a[0][t],o=a[1][t];this._nodeout[0].NodeEmit(t,n,o);var h=this._timeData[this._fftIndex]=.5*(n+o),r=2*Math.PI*this._fftIndex/this._fftCurrentSize;this._fftInData[this._fftrev[this._fftIndex]]=h*(.5-.5*Math.cos(r)),++this._fftIndex>=this._fftCurrentSize&&(this._fftIndex=0,this._fft(this._fftCurrentSize,this._fftInData,this._fftOutData))}this._nodein[0].NodeClear()}},waapisimConvolver=function(t){waapisimAudioNode.call(this,waapisimBufSize,1,1),this._nodetype="Convolver",waapisimDebug("create "+this._nodetype+this._nodeId),this.context=t,this.playbackState=0,this.buffer=null,this.normalize=!0,this._scale=1,this._analyzed=null,this._dlybufsize=5*waapisimSampleRate,this._dlybuf=new waapisimAudioBuffer(2,this._dlybufsize,44100),this._dlyidx=0,this._tapsize=20,this._tap=[],this._kernel=null,this._sum=[],this._sum[0]=[],this._sum[1]=[],this._bitrev=[],this._bitrev[0]=0,this._bitrev[waapisimBufSize-1]=waapisimBufSize-1;var i,e,a;for(i=0,e=1;waapisimBufSize-1>e;++e){for(a=waapisimBufSize>>1;a>(i^=a);a>>=1);this._bitrev[e]=i}for(i=0;2>i;++i)for(e=0;2>e;++e)this._sum[i][e]=new Float32Array(waapisimSampleRate);this._Normalize=function(t){for(var i=.00125,e=125e-6,a=2,s=t.length,n=0,o=0;a>o;++o){for(var h=0,r=0,u=s;u--;){var f=t.buf[o][h++];r+=f*f}n+=r}n=Math.sqrt(n/(a*s)),(isFinite(n)===!1||isNaN(n)||e>n)&&(n=e);var p=1/n;return p*=i},this._Fft=function(t,i){var e,a,s,n,o,h,r,u,f,p,d,c,l,m,_;for(n=0,o=1;t-1>o;o++){for(h=t>>1;h>(n^=h);h>>=1);n>o&&(m=i[o],i[o]=i[n],i[n]=m)}for(d=-2*Math.PI,a=1;(e=a<<1)<=t;a=e){for(s=a>>1,d*=.5,r=0;t>r;r+=e)f=r+a,m=i[f],i[f]=i[r]-m,i[r]+=m;for(n=1;s>n;n++)for(c=Math.cos(d*n),l=Math.sin(d*n),o=0;t>o;o+=e)r=o+n,u=o+a-n,f=o+a+n,p=o+e-n,m=c*i[f]+l*i[p],_=c*i[p]-l*i[f],i[f]=-i[u]+_,i[p]=i[u]+_,i[u]=i[r]-m,i[r]=i[r]+m}},this._Fft2=function(t,i,e){var a,s,n,o,h,r,u,f,p,d=2*Math.PI;for(n=0,o=1;t-1>o;o++){for(h=t>>1;h>(n^=h);h>>=1);n>o&&(f=i[o],p=e[o],i[o]=i[n],e[o]=e[n],i[n]=f,e[n]=p)}for(s=1;(a=s<<1)<=t;s=a)for(d*=.5,n=0;s>n;n++)for(r=Math.cos(d*n),u=Math.sin(d*n),o=n;t>o;o+=a)h=o+s,f=r*i[h]-u*e[h],p=r*e[h]+u*i[h],i[h]=i[o]-f,e[h]=e[o]-p,i[o]+=f,e[o]+=p;for(n=0;t>n;++n)i[n]=i[n]/t},this._Process=function(){var t,i,e,a,s,n,o,h=this._nodein[0].inbuf.buf,r=.5*waapisimBufSize|0;if(null!==this.buffer){if(this.buffer!=this._analyzed){var u=[];for(t=0;4>t;++t)u[t]=new waapisimAudioBuffer(2,waapisimBufSize,44100);this._scale=1,this.normalize&&(this._scale=this._Normalize(this.buffer));var f=this.buffer.length;for(t=f-1;t&&!(Math.abs(this.buffer.buf[0][t])>.001)&&!(Math.abs(this.buffer.buf[1][t])>.001);--t);for(f=t+1,t=0,s=0;t<this._tapsize;++t){var p=t*f/this._tapsize|0,d=p-s;if(n=0,o=0,d>0){for(;p>s;)n+=this.buffer.buf[0][s]*this.buffer.buf[0][s],o+=this.buffer.buf[1][s]*this.buffer.buf[1][s],++s;n=Math.sqrt(n)*this._scale*.5,o=Math.sqrt(o)*this._scale*.5}this._tap[t]=[p,n,o]}this._kernel=new waapisimAudioBuffer(2,waapisimBufSize,44100);var c=0,l=0;for(a=Math.min(this.buffer.length,4*waapisimBufSize),t=0,i=0,e=0;a>t;++t)n=this.buffer.buf[0][t],o=this.buffer.buf[1][t],u[e].buf[0][i]=n,u[e].buf[1][i]=o,c+=n*n+o*o,++i>=waapisimBufSize&&(c>l&&(this._kernel=u[e],l=c),i=0,c=0,++e);(c>l||null===this._kernel)&&(this._kernel=u[e]),this._Fft(waapisimBufSize,this._kernel.buf[0]),this._Fft(waapisimBufSize,this._kernel.buf[1]),this._analyzed=this.buffer
}for(this._Fft(waapisimBufSize,h[0]),this._Fft(waapisimBufSize,h[1]),this._sum[0][0][0]=this._sum[1][0][0]=this._sum[0][1][0]=this._sum[1][1][0]=0,t=1,i=waapisimBufSize-1;r>t;++t,--i){var m=h[0][t]*this._kernel.buf[0][t]-h[0][i]*this._kernel.buf[0][i],_=h[0][t]*this._kernel.buf[0][i]+h[0][i]*this._kernel.buf[0][t];this._sum[0][0][t]=m,this._sum[0][0][i]=m,this._sum[0][1][t]=-_,this._sum[0][1][i]=_;var w=h[1][t]*this._kernel.buf[1][t]-h[1][i]*this._kernel.buf[1][i],b=h[1][t]*this._kernel.buf[1][i]+h[1][i]*this._kernel.buf[1][t];this._sum[1][0][t]=w,this._sum[1][0][i]=w,this._sum[1][1][t]=-b,this._sum[1][1][i]=b}for(this._Fft2(waapisimBufSize,this._sum[0][0],this._sum[0][1]),this._Fft2(waapisimBufSize,this._sum[1][0],this._sum[1][1]),t=0;waapisimBufSize>t;++t){var y=(r-Math.abs(t-r))/r;for(this._dlybuf.buf[0][this._dlyidx]=this._sum[0][0][t]*y,this._dlybuf.buf[1][this._dlyidx]=this._sum[1][0][t]*y,n=0,o=0,a=this._tap.length,i=0;a>i;++i){for(var S=this._dlyidx-this._tap[i][0];0>S;)S+=this._dlybufsize;n+=this._dlybuf.buf[0][S]*this._tap[i][1],o+=this._dlybuf.buf[1][S]*this._tap[i][2]}this._nodeout[0].NodeEmit(t,n,o),++this._dlyidx>=this._dlybufsize&&(this._dlyidx=0)}}this._nodein[0].NodeClear()}},waapisimDynamicsCompressor=function(t){waapisimAudioNode.call(this,waapisimBufSize,1,1),this._nodetype="DynComp",waapisimDebug("create "+this._nodetype+this._nodeId),this.context=t,this.playbackState=0,this.threshold=new waapisimAudioParam(t,this,-100,0,-24),this.knee=new waapisimAudioParam(t,this,0,40,30),this.ratio=new waapisimAudioParam(t,this,1,20,12),this.reduction=new waapisimAudioParam(t,this,-20,0,0),this.attack=new waapisimAudioParam(t,this,0,1,.003),this.release=new waapisimAudioParam(t,this,0,1,.25),this._maxl=0,this._maxr=0,this._gain=1,this._Process=function(){this.threshold._Process(),this.knee._Process(),this.ratio._Process(),this.attack._Process(),this.release._Process();var t=this._nodein[0].inbuf.buf,i=this.release.Get(0)*waapisimSampleRate;i=Math.pow(1/3.16,1/i);var e=this.attack.Get(0)*waapisimSampleRate;e=Math.pow(1/3.16,1/e);var a=this.reduction.value,s=Math.pow(10,this.threshold.Get(0)/20),n=Math.pow(10,this.knee.Get(0)/20*.5),o=1/Math.sqrt(s)/Math.pow(10,this.knee.Get(0)/80),h=.99105,r=this.ratio.Get(0);1>=r&&(r=1);for(var u=0;waapisimBufSize>u;++u){this._maxl=h*this._maxl+(1-h)*t[0][u]*t[0][u],this._maxr=h*this._maxr+(1-h)*t[1][u]*t[1][u];var f=1.414*Math.sqrt(Math.max(this._maxl,this._maxr));if(f>s){var p=Math.pow(s*Math.min(n,f/s)/f,1-1/r);this._gain=p+(this._gain-p)*e}else this._gain=1+(this._gain-1)*i;var d=this._gain*o;this._nodeout[0].NodeEmit(u,t[0][u]*d,t[1][u]*d)}this.reduction.value=this.reduction.computedValue=a,this._nodein[0].NodeClear(),this.threshold.Clear(!1),this.knee.Clear(!1),this.ratio.Clear(!1),this.reduction.Clear(!1),this.attack.Clear(!1),this.release.Clear(!1)}},waapisimPanner=webkitAudioPannerNode=AudioPannerNode=function(t){waapisimAudioNode.call(this,waapisimBufSize,1,1),this._nodetype="Panner",waapisimDebug("create "+this._nodetype+this._nodeId),this.context=t,this.playbackState=0,this.panningModel=0,this.distanceModel=1,this.refDistance=1,this.maxDistance=1e4,this.rolloffFactor=1,this.coneInnerAngle=360,this.coneOuterAngle=360,this.coneOuterGain=0,this.px=0,this.py=0,this.pz=0,this.setPosition=function(t,i,e){this.px=t,this.py=i,this.pz=e},this.setOrientation=function(){},this.setVelocity=function(){},this._Process=function(){var t,i=this._nodein[0].inbuf.buf,e=this.context.listener,a=this.px-e.px,s=this.py-e.py,n=this.pz-e.pz,o=Math.max(1,Math.sqrt(a*a+s*s+n*n));switch(this.distanceModel){case"linear":case 0:t=1-this.rolloffFactor*(o-this.refDistance)/(this.maxDistance-this.refDistance);break;case"inverse":case 1:t=this.refDistance/(this.refDistance+this.rolloffFactor*(o-this.refDistance));break;case"exponential":case 2:t=Math.pow(o/this.refDistance,-this.rolloffFactor)}var h,r,u;if(Math.abs(n)<.001)r=h=1;else if(u=Math.atan(a/n),0>=n)h=-u+.5*Math.PI,r=u+.5*Math.PI;else switch(this.panningModel){case 0:case"equalpower":h=u+.5*Math.PI,r=-u+.5*Math.PI;break;default:a>=0?(h=u+.5*Math.PI,r=-(-u+.5*Math.PI)):(h=-(u+.5*Math.PI),r=-u+.5*Math.PI)}var f=Math.sqrt(h*h+r*r);h/=f,r/=f;var p=Math.sqrt(h*h+r*r);h=h/p*2*t,r=r/p*2*t;for(var d=0;waapisimBufSize>d;++d)this._nodeout[0].NodeEmit(d,i[0][d]*r,i[1][d]*h);this._nodein[0].NodeClear()}},waapisimPanner.EQUALPOWER=waapisimPanner.prototype.EQUALPOWER=0,waapisimPanner.HRTF=waapisimPanner.prototype.HRTF=1,waapisimPanner.SOUNDFIELD=waapisimPanner.prototype.SOUNDFIELD=2,waapisimPanner.LINEAR_DISTANCE=waapisimPanner.prototype.LINEAR_DISTANCE=0,waapisimPanner.INVERSE_DISTANCE=waapisimPanner.prototype.INVERSE_DISTANCE=1,waapisimPanner.EXPONENTIAL_DISTANCE=waapisimPanner.prototype.EXPONENTIAL_DISTANCE=2,waapisimChannelSplitter=function(t,i){this._nodetype="ChSplit",waapisimDebug("create "+this._nodetype+this._nodeId),"undefined"==typeof i&&(i=6),waapisimAudioNode.call(this,waapisimBufSize,1,i),this.context=t,this.playbackState=0,this._Process=function(){for(var t=this._nodein[0].inbuf.buf,i=0;waapisimBufSize>i;++i)this._nodeout[0].NodeEmit(i,t[0][i],t[0][i]),this._nodeout[1].NodeEmit(i,t[1][i],t[1][i]);this._nodein[0].NodeClear()}},waapisimChannelMerger=function(t,i){this._nodetype="ChMerge",waapisimDebug("create "+this._nodetype+this._nodeId),"undefined"==typeof i&&(i=6),waapisimAudioNode.call(this,waapisimBufSize,i,1),this.context=t,this.playbackState=0,this._Process=function(){for(var t=this._nodein[0].inbuf.buf,i=this._nodein[1].inbuf.buf,e=0;waapisimBufSize>e;++e)this._nodeout[0].NodeEmit(e,.5*(t[0][e]+t[1][e]),.5*(i[0][e]+i[1][e]));this._nodein[0].NodeClear(),this._nodein[1].NodeClear()}},waapisimWaveShaper=function(t){waapisimAudioNode.call(this,waapisimBufSize,1,1),this._nodetype="Shaper",waapisimDebug("create "+this._nodetype+this._nodeId),this.context=t,this.playbackState=0,this.curve=null;var i;this._Process=function(){var t=this._nodein[0].inbuf.buf,e=this.curve;if(null!==e){var a=e.length-1;if(a>=0){for(i=0;waapisimBufSize>i;++i){var s=Math.max(-1,Math.min(1,t[0][i])),n=Math.max(-1,Math.min(1,t[1][i]));s=e[.5*(s+1)*a+.5|0],n=e[.5*(n+1)*a+.5|0],this._nodeout[0].NodeEmit(i,s,n)}return void this._nodein[0].NodeClear()}}for(i=0;waapisimBufSize>i;++i)this._nodeout[0].NodeEmit(i,t[0][i],t[1][i]);this._nodein[0].NodeClear()}},waapisimAudioParam=function(t,i,e,a,s,n){this.context=t,this._targettype=0,this.node=i,this.value=s,this.computedValue=s,this.minValue=e,this.maxValue=a,this.defaultValue=s,this.timeconst="undefined"==typeof n?0:n,this.from=[],this.inbuf={},this.inbuf.buf=[],this.inbuf.buf[0]=new Float32Array(waapisimBufSize),this.inbuf.buf[1]=new Float32Array(waapisimBufSize),this.automation=[],this.deltaAdd=0,this.deltaMul=1,this.deltaTarget=0,this.currentEvent=null;for(var o=0;waapisimBufSize>o;++o)this.inbuf.buf[0][o]=this.inbuf.buf[1][o]=0;this.AddEvent=function(t){for(var i=t[0],e=this.automation.length,a=0;e>a&&!(this.automation[a][0]>i);++a);this.automation.splice(a,0,t)},this.setValueAtTime=function(t,i){this.AddEvent([i,0,t])},this.linearRampToValueAtTime=function(t,i){this.AddEvent([i,1,t])},this.exponentialRampToValueAtTime=function(t,i){this.AddEvent([i,2,t])},this.setTargetAtTime=this.setTargetValueAtTime=function(t,i,e){this.AddEvent([i,3,t,e])},this.setValueCurveAtTime=function(t,i,e){this.AddEvent([i,4,t,e])},this.cancelScheduledValues=function(t){for(var i=this.automation.length,e=0;i>e;++e)if(this.automation[e][0]>=t)return void(this.automation.length=e)},this._Process=function(){if(this.value+=this.deltaAdd,this.value=(this.value-this.deltaTarget)*this.deltaMul+this.deltaTarget,null!==this.currentEvent&&4==this.currentEvent[1]){var t=(this.currentEvent[2].length-1)*(this.context.currentTime-this.currentEvent[0])/this.currentEvent[3];this.value=this.currentEvent[2][0|Math.min(this.currentEvent[2].length-1,t)]}if(this.automation.length>0&&this.context.currentTime>=this.automation[0][0]){switch(this.deltaAdd=0,this.deltaMul=1,this.deltaTarget=0,this.currentEvent=this.automation.shift(),this.currentEvent[1]){case 0:case 1:case 2:this.value=this.currentEvent[2];break;case 3:this.deltaMul=Math.pow(.367879,1/(waapisimSampleRate/waapisimBufSize*this.currentEvent[3])),this.deltaTarget=this.currentEvent[2]}if(this.automation.length>0){var i=waapisimSampleRate/waapisimBufSize*(this.automation[0][0]-this.context.currentTime);switch(this.automation[0][1]){case 1:this.deltaAdd=(this.automation[0][2]-this.value)/i;break;case 2:this.deltaMul=Math.pow(this.automation[0][2]/this.value,1/i)}}}},this.Init=function(){this.computedValue=parseFloat(this.value)},this.Get=function(t){return this.computedValue=this.from.length>0?parseFloat(this.value)+.5*(this.inbuf.buf[0][t]+this.inbuf.buf[1][t]):this.computedValue*this.timeconst+(1-this.timeconst)*parseFloat(this.value),this.computedValue},this.Clear=function(t){if(t)for(var i=0;waapisimBufSize>i;++i)this.inbuf.buf[0][i]=this.inbuf.buf[1][i]=0;else this.inbuf.buf[0][0]=this.inbuf.buf[1][0]=0}}}